INFO:__main__:🔍 Enhanced detailed logging enabled - output: /mnt/c/Users/chris/Cloud-Drive_christianhaddad8@gmail.com/Cloud-Drive/Full/claude code/Amazon-FBA-Agent-System-v3/logs/debug/run_complete_fba_system_20250708_172016.log
DEBUG:asyncio:Using selector: EpollSelector
INFO:__main__:🚀 Complete FBA System v3 initialized
INFO:__main__:🏭 Processing supplier: poundwholesale-co-uk
INFO:__main__:🔗 URL: https://www.poundwholesale.co.uk/
INFO:__main__:📧 Email: info@theblacksmithmarket.com
INFO:__main__:🖥️ Headed mode: False
INFO:__main__:📦 Max products: 21
INFO:__main__:🔄 Force regenerate: False
INFO:__main__:📦 Archiving expected output files for verification...
INFO:__main__:Archive mode set to: ''
WARNING:__main__:Unknown archive mode: ''. Skipping archive.
INFO:tools.supplier_guard:🛡️ Supplier Guard initialized
INFO:__main__:⚠️ Supplier poundwholesale-co-uk not ready: No .supplier_ready file found in suppliers/poundwholesale-co-uk
INFO:__main__:🔍 New supplier detected: poundwholesale-co-uk. Generating automation package...
WARNING:tools.supplier_script_generator:Failed to load system config: Extra data: line 93 column 4 (char 4387)
INFO:tools.supplier_guard:🛡️ Supplier Guard initialized
INFO:tools.supplier_script_generator:🧠 Intelligent Supplier Script Generator initialized for: https://www.poundwholesale.co.uk/
INFO:tools.supplier_script_generator:📁 Supplier directory: suppliers/poundwholesale-co-uk
INFO:tools.supplier_script_generator:🚀 Starting intelligent supplier script generation...
INFO:tools.supplier_script_generator:🔍 Checking existing supplier state...
INFO:tools.supplier_script_generator:No .supplier_ready file found, proceeding with generation
INFO:tools.supplier_script_generator:🌐 Initializing browser connection...
INFO:tools.supplier_script_generator:✅ Connected to existing Chrome debug instance
INFO:tools.supplier_script_generator:📄 Navigated to: https://www.poundwholesale.co.uk/
INFO:tools.supplier_script_generator:🧠 Starting AI-powered element discovery...
INFO:tools.vision_discovery_engine:🔍 Enhanced Vision Discovery Engine initialized with multimodal AI capabilities
INFO:tools.supplier_script_generator:🔐 Discovering login elements...
INFO:tools.vision_discovery_engine:🔐 Starting enhanced multimodal login discovery...
INFO:tools.vision_discovery_engine:📄 Extracting page HTML content...
DEBUG:tools.vision_discovery_engine:🧹 Aggressively pruning HTML content for AI analysis...
WARNING:tools.vision_discovery_engine:HTML content for AI analysis was truncated to 15000 characters. The original size was 150898. AI context may be incomplete.
DEBUG:tools.vision_discovery_engine:✅ HTML aggressively pruned to 15000 characters
INFO:tools.vision_discovery_engine:📊 HTML content processed: 15000 characters after pruning
INFO:tools.vision_discovery_engine:📸 Capturing page screenshot...
INFO:tools.vision_discovery_engine:🧠 Performing multimodal AI analysis for login elements...
DEBUG:tools.vision_discovery_engine:🧠 Sending multimodal request to AI model...
WARNING:tools.vision_discovery_engine:Could not load or apply AI assistance hint: Extra data: line 93 column 4 (char 4387)
DEBUG:httpcore.connection:connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f76420d2bd0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x7f76425b3050> server_hostname='api.openai.com' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f76421ab620>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 08 Jul 2025 13:20:30 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-eywvpvgw4dvq99ktk9fwsqol'), (b'openai-processing-ms', b'1947'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'1825'), (b'x-ratelimit-limit-input-images', b'50000'), (b'x-ratelimit-limit-requests', b'500'), (b'x-ratelimit-limit-tokens', b'200000'), (b'x-ratelimit-remaining-input-images', b'49999'), (b'x-ratelimit-remaining-requests', b'499'), (b'x-ratelimit-remaining-tokens', b'195200'), (b'x-ratelimit-reset-input-images', b'1ms'), (b'x-ratelimit-reset-requests', b'120ms'), (b'x-ratelimit-reset-tokens', b'1.44s'), (b'x-request-id', b'req_6ee5026cca8da97484d3f133b42331da'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=x9oDehZERSDIQ64em0t00mT72Tzdu0gv1x00uHzhpxE-1751980830-1.0.1.1-16i2SyahGbKAv6GM9LCHDiBwYkwgMKPGSG5NmG.yOWbzDyhdO4t8oqTcXSYAvoB7Z2vZNVXZnM5THkDmixOZZz179JbCQrKMPDNUG15daCA; path=/; expires=Tue, 08-Jul-25 13:50:30 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=zfDFVALwETsp18x1BhkM8UksMi4c5.NnIY.rWhR2DA0-1751980830560-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95bfe1084d6c8a0d-DXB'), (b'Content-Encoding', b'br'), (b'alt-svc', b'h3=":443"; ma=86400')])
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:tools.vision_discovery_engine:🎯 AI response received: {
  "email_selector": "input#email",
  "password_selector": "input#pass",
  "submit_selector": "butt...
INFO:tools.vision_discovery_engine:✅ Login selectors extracted: {'email_selector': 'input#email', 'password_selector': 'input#pass', 'submit_selector': 'button#send2'}
INFO:tools.vision_discovery_engine:✅ Login elements discovered successfully via multimodal analysis
INFO:tools.vision_discovery_engine:🔍 Validating discovered selectors...
INFO:tools.vision_discovery_engine:🔍 Validating login selectors...
WARNING:tools.vision_discovery_engine:⚠️ Discovered selectors failed validation
INFO:tools.vision_discovery_engine:🔄 Falling back to heuristic discovery...
INFO:tools.vision_discovery_engine:🔄 Running heuristic login discovery...
INFO:tools.supplier_script_generator:🛍️ Discovering product and pagination selectors...
INFO:tools.vision_discovery_engine:🕷️ Starting vision-based product and pagination selector discovery...
INFO:tools.vision_discovery_engine:📄 Extracting page HTML content...
DEBUG:tools.vision_discovery_engine:🧹 Aggressively pruning HTML content for AI analysis...
WARNING:tools.vision_discovery_engine:HTML content for AI analysis was truncated to 15000 characters. The original size was 151071. AI context may be incomplete.
DEBUG:tools.vision_discovery_engine:✅ HTML aggressively pruned to 15000 characters
INFO:tools.vision_discovery_engine:📊 HTML content processed: 15000 characters after pruning
INFO:tools.vision_discovery_engine:📸 Capturing page screenshot...
INFO:tools.vision_discovery_engine:🧠 Performing multimodal AI analysis for product and pagination elements...
WARNING:tools.vision_discovery_engine:Could not load additional selectors from config: Extra data: line 93 column 4 (char 4387). Using core selectors only.
WARNING:tools.vision_discovery_engine:Could not load or apply AI assistance hint: Extra data: line 93 column 4 (char 4387)
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f7641c8d220>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x7f76425b3050> server_hostname='api.openai.com' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f7641c8cef0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 08 Jul 2025 13:20:43 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-eywvpvgw4dvq99ktk9fwsqol'), (b'openai-processing-ms', b'3721'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'3501'), (b'x-ratelimit-limit-input-images', b'50000'), (b'x-ratelimit-limit-requests', b'500'), (b'x-ratelimit-limit-tokens', b'200000'), (b'x-ratelimit-remaining-input-images', b'49999'), (b'x-ratelimit-remaining-requests', b'499'), (b'x-ratelimit-remaining-tokens', b'195128'), (b'x-ratelimit-reset-input-images', b'1ms'), (b'x-ratelimit-reset-requests', b'120ms'), (b'x-ratelimit-reset-tokens', b'1.461s'), (b'x-request-id', b'req_ac27f6dbcc832252eec2d8934a5a1785'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95bfe1452e4aad41-DXB'), (b'Content-Encoding', b'br'), (b'alt-svc', b'h3=":443"; ma=86400')])
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:tools.vision_discovery_engine:🎯 AI response received: {
  "product_container_selector": "li.product-item",
  "title_selector_relative": "a.product-item-li...
INFO:tools.vision_discovery_engine:✅ Product and pagination selectors extracted: {'product_container_selector': 'li.product-item', 'title_selector_relative': 'a.product-item-link', 'price_selector_relative': 'span.price', 'url_selector_relative': 'a.product-item-link', 'ean_selector_relative': '', 'next_page_selector': 'a.action.next', 'category_links_selector': 'ul.categories-list li a', 'breadcrumbs_selector': 'nav.breadcrumbs ol.items'}
INFO:tools.vision_discovery_engine:✅ Product and pagination elements discovered successfully via multimodal analysis
INFO:tools.vision_discovery_engine:🔍 Validating discovered selectors...
INFO:tools.vision_discovery_engine:🔍 Validating product and pagination selectors...
WARNING:tools.vision_discovery_engine:⚠️ Discovered selectors failed validation
INFO:tools.vision_discovery_engine:🔄 Falling back to heuristic discovery...
INFO:tools.vision_discovery_engine:🔄 Running heuristic product discovery...
INFO:tools.vision_discovery_engine:✅ Product selector validated: .product-item (5 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: .product (5 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: .item (4 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: .title (3 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: h2 a (3 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: h3 a (2 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: .product-name (5 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: .product-item a (3 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: h2 a (3 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: a[href*='product'] (2 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: .product-item img (3 elements)
INFO:tools.vision_discovery_engine:✅ Heuristic product discovery successful
WARNING:tools.supplier_script_generator:⚠️ Login discovery failed, creating empty config
INFO:tools.supplier_script_generator:💾 Saved product selectors: suppliers/poundwholesale-co-uk/config/product_selectors.json
INFO:tools.supplier_script_generator:📝 Generating scripts from templates...
INFO:tools.supplier_script_generator:📝 Generated login script: suppliers/poundwholesale-co-uk/scripts/poundwholesale-co-uk_login.py
INFO:tools.supplier_script_generator:📝 Generated product extractor script: suppliers/poundwholesale-co-uk/scripts/poundwholesale-co-uk_product_extractor.py
INFO:tools.supplier_script_generator:🧪 Starting test-after-generate validation...
INFO:tools.supplier_script_generator:🔐 Testing login script...
ERROR:tools.supplier_script_generator:Login script test failed: name 'Dict' is not defined
INFO:tools.supplier_script_generator:🤖 Performing AI failure analysis for login...
DEBUG:httpcore.connection:connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f7642469f70>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x7f7642a8b050> server_hostname='api.openai.com' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f7642469cd0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 08 Jul 2025 13:20:54 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-eywvpvgw4dvq99ktk9fwsqol'), (b'openai-processing-ms', b'2367'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'2124'), (b'x-ratelimit-limit-input-images', b'50000'), (b'x-ratelimit-limit-requests', b'500'), (b'x-ratelimit-limit-tokens', b'200000'), (b'x-ratelimit-remaining-input-images', b'49999'), (b'x-ratelimit-remaining-requests', b'499'), (b'x-ratelimit-remaining-tokens', b'199027'), (b'x-ratelimit-reset-input-images', b'1ms'), (b'x-ratelimit-reset-requests', b'120ms'), (b'x-ratelimit-reset-tokens', b'291ms'), (b'x-request-id', b'req_741d557f1efdda64ddb2994bcaab0ad1'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=271O8nEL8QxHr3XmNUyb9sGvzcXc4i71GhqyJyOLkRk-1751980854-1.0.1.1-5mouId2j6oKYH9XnZLpJMDR.r_24kYWqSERnsxzoLiruNDDT_xqjlxGbGsyo43HjFOQ6lQXP7C.kEb3CX98b4onIzuP4FBvhRgDtnEZIJX4; path=/; expires=Tue, 08-Jul-25 13:50:54 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=nC_DcelhiiiJ2PjyIaDFR8yiiLJm.G29h3lcL3yf4C0-1751980854302-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95bfe19cdf82b47f-DXB'), (b'Content-Encoding', b'br'), (b'alt-svc', b'h3=":443"; ma=86400')])
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
INFO:tools.supplier_script_generator:🤖 AI Diagnosis for login:
INFO:tools.supplier_script_generator:   Likely Cause: The login page or login form is not visible or not loaded; the page is showing the homepage content instead of the login screen.
INFO:tools.supplier_script_generator:   Suggested Fix: Ensure the script navigates explicitly to the login page URL or triggers the login form display before attempting to interact with login selectors.
INFO:tools.supplier_script_generator:🛍️ Testing product extraction script...
INFO:product_module:🛍️ Starting product extraction for 2 pages
INFO:product_module:📄 Processing page 1
INFO:product_module:🔍 Found 20 product containers
INFO:product_module:✅ Extracted 20 products from page 1
INFO:product_module:🧪 Test mode: stopping after 5 products
INFO:product_module:✅ Product extraction completed: 20 total products
INFO:tools.supplier_script_generator:✅ Validation completed - Login: False, Products: True
INFO:tools.supplier_script_generator:📋 Generating intelligent .supplier_ready file...
INFO:tools.supplier_guard:✅ Created intelligent .supplier_ready file for poundwholesale-co-uk: suppliers/poundwholesale-co-uk/.supplier_ready
INFO:tools.supplier_script_generator:✅ Created intelligent .supplier_ready file: suppliers/poundwholesale-co-uk/.supplier_ready
INFO:tools.supplier_script_generator:✅ Intelligent supplier script generation completed successfully
INFO:__main__:✅ Intelligent supplier automation package generated successfully for poundwholesale-co-uk
INFO:__main__:🚀 Initializing centralized browser session...
INFO:utils.browser_manager:🔧 BrowserManager singleton initialized
INFO:utils.browser_manager:🔌 Connecting to Chrome on debug port 9222
INFO:utils.browser_manager:📄 Using existing context with 4 pages
INFO:utils.browser_manager:✅ Connected to Chrome successfully
INFO:utils.browser_manager:📄 Created new page #1 for https://www.poundwholesale.co.uk
INFO:utils.browser_manager:✅ Page ready for https://www.poundwholesale.co.uk/
INFO:__main__:🔐 Performing dynamic supplier authentication...
INFO:__main__:📦 Loading dynamic supplier login script: suppliers/poundwholesale-co-uk/scripts/poundwholesale-co-uk_login.py
ERROR:__main__:❌ Browser setup or dynamic authentication failed: name 'Dict' is not defined
Traceback (most recent call last):
  File "/mnt/c/Users/chris/Cloud-Drive_christianhaddad8@gmail.com/Cloud-Drive/Full/claude code/Amazon-FBA-Agent-System-v3/run_complete_fba_system.py", line 433, in run_complete_system
    spec.loader.exec_module(supplier_login_module)
  File "<frozen importlib._bootstrap_external>", line 995, in exec_module
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/mnt/c/Users/chris/Cloud-Drive_christianhaddad8@gmail.com/Cloud-Drive/Full/claude code/Amazon-FBA-Agent-System-v3/suppliers/poundwholesale-co-uk/scripts/poundwholesale-co-uk_login.py", line 25, in <module>
    class Poundwholesale_Co_UkLogin:
  File "/mnt/c/Users/chris/Cloud-Drive_christianhaddad8@gmail.com/Cloud-Drive/Full/claude code/Amazon-FBA-Agent-System-v3/suppliers/poundwholesale-co-uk/scripts/poundwholesale-co-uk_login.py", line 87, in Poundwholesale_Co_UkLogin
    async def perform_login(self) -> Dict[str, Any]:
                                     ^^^^
NameError: name 'Dict' is not defined. Did you mean: 'dict'?
INFO:utils.browser_manager:🧹 Starting browser cleanup...
INFO:utils.browser_manager:🗑️ Closed 1 cached pages
INFO:utils.browser_manager:🔌 Disconnected from Chrome
INFO:utils.browser_manager:🎭 Stopped Playwright
INFO:utils.browser_manager:✅ Browser cleanup completed
INFO:utils.browser_manager:🧹 Global browser cleanup completed
INFO:utils.browser_manager:🧹 Starting browser cleanup...
INFO:utils.browser_manager:🗑️ Closed 0 cached pages
INFO:utils.browser_manager:✅ Browser cleanup completed
INFO:utils.browser_manager:🧹 Global browser cleanup completed
INFO:__main__:🧹 Browser cleanup completed
DEBUG:asyncio:Using selector: EpollSelector
INFO:utils.browser_manager:🧹 Starting browser cleanup...
INFO:utils.browser_manager:🗑️ Closed 0 cached pages
INFO:utils.browser_manager:✅ Browser cleanup completed
INFO:utils.browser_manager:🧹 Global browser cleanup completed
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
