INFO:__main__:🔍 Enhanced detailed logging enabled - output: /mnt/c/Users/chris/Cloud-Drive_christianhaddad8@Gmail.com/Cloud-Drive/Full/claude code/Amazon-FBA-Agent-System-v3/logs/debug/run_complete_fba_system_20250708_182531.log
DEBUG:asyncio:Using selector: EpollSelector
INFO:__main__:🚀 Complete FBA System v3 initialized
INFO:__main__:🏭 Processing supplier: poundwholesale-co-uk
INFO:__main__:🔗 URL: https://www.poundwholesale.co.uk/
INFO:__main__:📧 Email: info@theblacksmithmarket.com
INFO:__main__:🖥️ Headed mode: False
INFO:__main__:📦 Max products: 3
INFO:__main__:🔄 Force regenerate: True
INFO:__main__:📦 Archiving expected output files for verification...
INFO:__main__:Archive mode set to: ''
WARNING:__main__:Unknown archive mode: ''. Skipping archive.
INFO:tools.supplier_guard:🛡️ Supplier Guard initialized
INFO:tools.supplier_guard:📦 Archived supplier poundwholesale-co-uk to suppliers/poundwholesale-co-uk.bak_20250708142531UTC
INFO:__main__:📦 Archived existing data to: suppliers/poundwholesale-co-uk.bak_20250708142531UTC
INFO:__main__:🔍 Force regenerate requested: poundwholesale-co-uk. Generating automation package...
INFO:tools.supplier_guard:🛡️ Supplier Guard initialized
INFO:tools.supplier_script_generator:🧠 Intelligent Supplier Script Generator initialized for: https://www.poundwholesale.co.uk/
INFO:tools.supplier_script_generator:📁 Supplier directory: suppliers/poundwholesale-co-uk
INFO:tools.supplier_script_generator:🚀 Starting intelligent supplier script generation...
INFO:tools.supplier_script_generator:🌐 Initializing browser connection...
INFO:tools.supplier_script_generator:✅ Connected to existing Chrome debug instance
INFO:tools.supplier_script_generator:✅ Using active user page: https://www.poundwholesale.co.uk/...
INFO:tools.supplier_script_generator:📄 Navigated to: https://www.poundwholesale.co.uk/
INFO:tools.supplier_script_generator:🧠 Starting AI-powered element discovery...
INFO:tools.vision_discovery_engine:🔍 Enhanced Vision Discovery Engine initialized with multimodal AI capabilities
INFO:tools.supplier_script_generator:🔐 Discovering login elements...
INFO:tools.vision_discovery_engine:🔐 Starting enhanced multimodal login discovery...
INFO:tools.vision_discovery_engine:📄 Extracting page HTML content...
DEBUG:tools.vision_discovery_engine:🧹 Aggressively pruning HTML content for AI analysis...
WARNING:tools.vision_discovery_engine:HTML content for AI analysis was truncated to 15000 characters. The original size was 150897. AI context may be incomplete.
DEBUG:tools.vision_discovery_engine:✅ HTML aggressively pruned to 15000 characters
INFO:tools.vision_discovery_engine:📊 HTML content processed: 15000 characters after pruning
INFO:tools.vision_discovery_engine:📸 Capturing page screenshot...
INFO:tools.vision_discovery_engine:🧠 Performing multimodal AI analysis for login elements...
DEBUG:tools.vision_discovery_engine:🧠 Sending multimodal request to AI model...
DEBUG:httpcore.connection:connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f149e40a930>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x7f149ed72250> server_hostname='api.openai.com' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f149d74a0f0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 08 Jul 2025 14:25:50 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-eywvpvgw4dvq99ktk9fwsqol'), (b'openai-processing-ms', b'7505'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'4456'), (b'x-ratelimit-limit-input-images', b'50000'), (b'x-ratelimit-limit-requests', b'500'), (b'x-ratelimit-limit-tokens', b'200000'), (b'x-ratelimit-remaining-input-images', b'49999'), (b'x-ratelimit-remaining-requests', b'499'), (b'x-ratelimit-remaining-tokens', b'195200'), (b'x-ratelimit-reset-input-images', b'1ms'), (b'x-ratelimit-reset-requests', b'120ms'), (b'x-ratelimit-reset-tokens', b'1.44s'), (b'x-request-id', b'req_14ef5e20fe2b2e1d83b77738dcd1b0ce'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=35TcVW9X0a4JD_Twdf_pLmT1HJ.GFCn77SW12waFwy4-1751984750-1.0.1.1-QRoST9bD.DSkQ6ZJft3IywLmn1nJ1QUXU3OFzIWY7QuFhaMHp9QsgUvGy087QPD_bSi8AvokhADJ0Z6jOWwe14ST5ygspiM1N1AKMJGyxXE; path=/; expires=Tue, 08-Jul-25 14:55:50 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=7GKG4pleXNyf0ycUr7g1gwCJakmKL23VYvWiGcRbHLg-1751984750511-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95c0408db8dead41-DXB'), (b'Content-Encoding', b'br'), (b'alt-svc', b'h3=":443"; ma=86400')])
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:tools.vision_discovery_engine:🎯 AI response received: {
  "email_selector": "input#email",
  "password_selector": "input#pass",
  "submit_selector": "butt...
INFO:tools.vision_discovery_engine:✅ Login selectors extracted: {'email_selector': 'input#email', 'password_selector': 'input#pass', 'submit_selector': 'button#send2'}
INFO:tools.vision_discovery_engine:✅ Login elements discovered successfully via multimodal analysis
INFO:tools.vision_discovery_engine:🔍 Validating discovered selectors...
INFO:tools.vision_discovery_engine:🔍 Validating login selectors...
WARNING:tools.vision_discovery_engine:⚠️ Discovered selectors failed validation
INFO:tools.vision_discovery_engine:🔄 Falling back to heuristic discovery...
INFO:tools.vision_discovery_engine:🔄 Running heuristic login discovery...
INFO:tools.supplier_script_generator:🛍️ Discovering product and pagination selectors...
INFO:tools.vision_discovery_engine:🕷️ Starting vision-based product and pagination selector discovery...
INFO:tools.vision_discovery_engine:📄 Extracting page HTML content...
DEBUG:tools.vision_discovery_engine:🧹 Aggressively pruning HTML content for AI analysis...
WARNING:tools.vision_discovery_engine:HTML content for AI analysis was truncated to 15000 characters. The original size was 151071. AI context may be incomplete.
DEBUG:tools.vision_discovery_engine:✅ HTML aggressively pruned to 15000 characters
INFO:tools.vision_discovery_engine:📊 HTML content processed: 15000 characters after pruning
INFO:tools.vision_discovery_engine:📸 Capturing page screenshot...
INFO:tools.vision_discovery_engine:🧠 Performing multimodal AI analysis for product and pagination elements...
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 08 Jul 2025 14:26:02 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-eywvpvgw4dvq99ktk9fwsqol'), (b'openai-processing-ms', b'4919'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'4823'), (b'x-ratelimit-limit-input-images', b'50000'), (b'x-ratelimit-limit-requests', b'500'), (b'x-ratelimit-limit-tokens', b'200000'), (b'x-ratelimit-remaining-input-images', b'49999'), (b'x-ratelimit-remaining-requests', b'499'), (b'x-ratelimit-remaining-tokens', b'194887'), (b'x-ratelimit-reset-input-images', b'1ms'), (b'x-ratelimit-reset-requests', b'120ms'), (b'x-ratelimit-reset-tokens', b'1.533s'), (b'x-request-id', b'req_35d33c3052562c329f0fba59ee06fc6a'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95c040ed1df4ad41-DXB'), (b'Content-Encoding', b'br'), (b'alt-svc', b'h3=":443"; ma=86400')])
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:tools.vision_discovery_engine:🎯 AI response received: {
  "product_container_selector": "li.product-item",
  "title_selector_relative": "a.product-item-li...
INFO:tools.vision_discovery_engine:✅ Product and pagination selectors extracted: {'product_container_selector': 'li.product-item', 'title_selector_relative': 'a.product-item-link', 'price_selector_relative': 'span.price', 'url_selector_relative': 'a.product-item-link', 'ean_selector_relative': '', 'next_page_selector': 'a.action.next', 'category_links_selector': 'ul.categories-list > li > a', 'breadcrumbs_selector': 'nav.breadcrumbs ol.items li.item a', 'image_selector_relative': 'img.product-image-photo', 'description_selector_relative': 'div.product-item-details div.product-item-description', 'out_of_stock_selector_relative': 'div.stock.unavailable, span.stock.unavailable', 'previous_page_selector': 'a.action.previous', 'page_numbers_selector': 'ol.items > li > a', 'price_filter_selector': "div.filter-options-item.price, div.filter-options-item[data-filter='price']", 'category_filter_selector': "div.filter-options-item.category, div.filter-options-item[data-filter='category']", 'search_box_selector': "input#search, input[name='q'], input.search-field", 'products_per_page_selector': "select.products-per-page, select[name='limit']", 'product limiter_selector': "select.products-per-page, select[name='limit']"}
INFO:tools.vision_discovery_engine:✅ Product and pagination elements discovered successfully via multimodal analysis
INFO:tools.vision_discovery_engine:🔍 Validating discovered selectors...
INFO:tools.vision_discovery_engine:🔍 Validating product and pagination selectors...
WARNING:tools.vision_discovery_engine:⚠️ Discovered selectors failed validation
INFO:tools.vision_discovery_engine:🔄 Falling back to heuristic discovery...
INFO:tools.vision_discovery_engine:🔄 Running heuristic product discovery...
INFO:tools.vision_discovery_engine:✅ Product selector validated: .product-item (5 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: .product (5 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: .item (4 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: .title (3 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: h2 a (3 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: h3 a (2 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: .product-name (5 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: .product-item a (3 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: h2 a (3 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: a[href*='product'] (2 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: .product-item img (3 elements)
INFO:tools.vision_discovery_engine:✅ Heuristic product discovery successful
WARNING:tools.supplier_script_generator:⚠️ Login discovery failed, creating empty config
INFO:tools.supplier_script_generator:💾 Saved product selectors: suppliers/poundwholesale-co-uk/config/product_selectors.json
INFO:tools.supplier_script_generator:📝 Generating scripts from templates...
INFO:tools.supplier_script_generator:📝 Generated login script: suppliers/poundwholesale-co-uk/scripts/poundwholesale-co-uk_login.py
INFO:tools.supplier_script_generator:📝 Generated product extractor script: suppliers/poundwholesale-co-uk/scripts/poundwholesale-co-uk_product_extractor.py
INFO:tools.supplier_script_generator:🧪 Starting test-after-generate validation...
INFO:tools.supplier_script_generator:🔐 Testing login script...
INFO:login_module:🔐 Starting login to https://www.poundwholesale.co.uk/
INFO:login_module:❌ Not logged in
INFO:login_module:🔗 Clicking login trigger: text=sign in
INFO:login_module:✅ Email filled
INFO:login_module:✅ Password filled
INFO:login_module:🚫 Dismissing modal overlay: .modals-overlay
WARNING:login_module:Normal click failed: Page.click: Timeout 30000ms exceeded.
Call log:
  - waiting for locator(".btn.btn-primary.btn-block, button:has-text('Login'), button:has-text('Sign in'), button[type='submit'], .btn.btn-primary, .btn-primary, input[type='submit']")
  -     - locator resolved to 4 elements. Proceeding with the first one: <button type="submit" title="Subscribe" aria-label="Subscribe" class="action subscribe primary">…</button>
  -   - attempting click action
  -     2 × waiting for element to be visible, enabled and stable
  -       - element is visible, enabled and stable
  -       - scrolling into view if needed
  -       - done scrolling
  -       - <div class="modals-overlay"></div> from <div class="modals-wrapper">…</div> subtree intercepts pointer events
  -     - retrying click action
  -     - waiting 20ms
  -     2 × waiting for element to be visible, enabled and stable
  -       - element is visible, enabled and stable
  -       - scrolling into view if needed
  -       - done scrolling
  -       - <div class="modals-overlay"></div> from <div class="modals-wrapper">…</div> subtree intercepts pointer events
  -     - retrying click action
  -       - waiting 100ms
  -     55 × waiting for element to be visible, enabled and stable
  -        - element is visible, enabled and stable
  -        - scrolling into view if needed
  -        - done scrolling
  -        - <div class="modals-overlay"></div> from <div class="modals-wrapper">…</div> subtree intercepts pointer events
  -      - retrying click action
  -        - waiting 500ms
, trying force click
INFO:login_module:✅ Submit button force-clicked
INFO:login_module:❌ Not logged in
WARNING:login_module:❌ Login verification failed - analyzing current page state...
INFO:login_module:📸 Screenshot saved: logs/debug/login_failure_screenshot_20250708_182718.png
INFO:login_module:📄 Current page HTML length: 505748 characters
WARNING:login_module:🚨 Detected potential error indicators: ['code']
ERROR:login_module:Failed to analyze login failure: object str can't be used in 'await' expression
INFO:tools.supplier_script_generator:🤖 Performing AI failure analysis for login...
DEBUG:httpcore.connection:connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f149ea18410>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x7f149f03aa50> server_hostname='api.openai.com' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f149ea18530>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
