INFO:__main__:🔍 Enhanced detailed logging enabled - output: /mnt/c/Users/chris/Cloud-Drive_christianhaddad8@Gmail.com/Cloud-Drive/Full/claude code/Amazon-FBA-Agent-System-v3/logs/debug/run_complete_fba_system_20250708_185302.log
DEBUG:asyncio:Using selector: EpollSelector
INFO:__main__:🚀 Complete FBA System v3 initialized
INFO:__main__:🏭 Processing supplier: poundwholesale-co-uk
INFO:__main__:🔗 URL: https://www.poundwholesale.co.uk/
INFO:__main__:📧 Email: info@theblacksmithmarket.com
INFO:__main__:🖥️ Headed mode: False
INFO:__main__:📦 Max products: 3
INFO:__main__:🔄 Force regenerate: True
INFO:__main__:📦 Archiving expected output files for verification...
INFO:__main__:Archive mode set to: ''
WARNING:__main__:Unknown archive mode: ''. Skipping archive.
INFO:tools.supplier_guard:🛡️ Supplier Guard initialized
INFO:tools.supplier_guard:📦 Archived supplier poundwholesale-co-uk to suppliers/poundwholesale-co-uk.bak_20250708145302UTC
INFO:__main__:📦 Archived existing data to: suppliers/poundwholesale-co-uk.bak_20250708145302UTC
INFO:__main__:🔍 Force regenerate requested: poundwholesale-co-uk. Generating automation package...
INFO:tools.supplier_guard:🛡️ Supplier Guard initialized
INFO:tools.supplier_script_generator:🧠 Intelligent Supplier Script Generator initialized for: https://www.poundwholesale.co.uk/
INFO:tools.supplier_script_generator:📁 Supplier directory: suppliers/poundwholesale-co-uk
INFO:tools.supplier_script_generator:🚀 Starting intelligent supplier script generation...
INFO:tools.supplier_script_generator:🌐 Initializing browser connection...
INFO:tools.supplier_script_generator:✅ Connected to existing Chrome debug instance
INFO:tools.supplier_script_generator:✅ Using active user page: https://www.poundwholesale.co.uk/...
INFO:tools.supplier_script_generator:✅ Already on target domain www.poundwholesale.co.uk, preserving current page state
INFO:tools.supplier_script_generator:📄 Navigated to: https://www.poundwholesale.co.uk/
INFO:tools.supplier_script_generator:🧠 Starting AI-powered element discovery...
INFO:tools.vision_discovery_engine:🔍 Enhanced Vision Discovery Engine initialized with multimodal AI capabilities
INFO:tools.supplier_script_generator:🔐 Discovering login elements...
INFO:tools.vision_discovery_engine:🔐 Starting enhanced multimodal login discovery...
INFO:tools.vision_discovery_engine:📄 Extracting page HTML content...
INFO:tools.vision_discovery_engine:🔍 Attempting local HTML analysis first...
INFO:tools.vision_discovery_engine:🔍 Performing local HTML analysis for login selectors...
INFO:tools.vision_discovery_engine:📄 Saved HTML to: logs/debug/login_html_analysis_20250708_185304.html
INFO:tools.vision_discovery_engine:🔗 Found potential login URLs: ['https://www.poundwholesale.co.uk/customer/account/login/referer/aHR0cHM6Ly93d3cucG91bmR3aG9sZXNhbGUuY28udWsvZGlkLWNob3BwaW5nLWJvYXJkLTE2NS14LTI3MG1tLWFzc29ydGVkLWNvbG91cnM~/', 'https://www.poundwholesale.co.uk/customer/account/login/', 'https://www.poundwholesale.co.uk/customer/account/create/', 'https://www.poundwholesale.co.uk/customer/account/forgotpassword/', 'chrome-extension://kidmffepbniamfbibhfgdakkggchipjl/proxy.html?appUrl=https%3A%2F%2Fsas.selleramp.com%2Faccount%3Fsrc%3Dext%26ver%3D2.4.5e', '#col-customer-care']
INFO:tools.vision_discovery_engine:🎯 Local analysis found selectors: {'email_selector': '#newsletter', 'password_selector': '#pass', 'submit_selector': '#send2-login', 'login_urls': ['https://www.poundwholesale.co.uk/customer/account/login/referer/aHR0cHM6Ly93d3cucG91bmR3aG9sZXNhbGUuY28udWsvZGlkLWNob3BwaW5nLWJvYXJkLTE2NS14LTI3MG1tLWFzc29ydGVkLWNvbG91cnM~/', 'https://www.poundwholesale.co.uk/customer/account/login/', 'https://www.poundwholesale.co.uk/customer/account/create/', 'https://www.poundwholesale.co.uk/customer/account/forgotpassword/', 'chrome-extension://kidmffepbniamfbibhfgdakkggchipjl/proxy.html?appUrl=https%3A%2F%2Fsas.selleramp.com%2Faccount%3Fsrc%3Dext%26ver%3D2.4.5e', '#col-customer-care']}
INFO:tools.vision_discovery_engine:💾 Saved analysis to: logs/debug/login_analysis_20250708_185304.json
INFO:tools.vision_discovery_engine:✅ Login elements discovered via local analysis
INFO:tools.vision_discovery_engine:🔍 Validating locally discovered selectors...
INFO:tools.vision_discovery_engine:🔍 Validating login selectors...
INFO:tools.vision_discovery_engine:✅ Email selector validated: #newsletter
WARNING:tools.vision_discovery_engine:⚠️ Local selectors failed validation, trying multimodal analysis...
INFO:tools.vision_discovery_engine:🧠 Falling back to multimodal AI analysis...
DEBUG:tools.vision_discovery_engine:🧹 Aggressively pruning HTML content for AI analysis...
WARNING:tools.vision_discovery_engine:HTML content for AI analysis was truncated to 15000 characters. The original size was 150903. AI context may be incomplete.
DEBUG:tools.vision_discovery_engine:✅ HTML aggressively pruned to 15000 characters
INFO:tools.vision_discovery_engine:📊 HTML content processed: 15000 characters after pruning
INFO:tools.vision_discovery_engine:📸 Capturing page screenshot...
INFO:tools.vision_discovery_engine:🧠 Performing multimodal AI analysis for login elements...
DEBUG:tools.vision_discovery_engine:🧠 Sending multimodal request to AI model...
DEBUG:httpcore.connection:connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f5729c04c20>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x7f572a269f50> server_hostname='api.openai.com' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f5728e789b0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 08 Jul 2025 14:53:10 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-eywvpvgw4dvq99ktk9fwsqol'), (b'openai-processing-ms', b'919'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'815'), (b'x-ratelimit-limit-input-images', b'50000'), (b'x-ratelimit-limit-requests', b'500'), (b'x-ratelimit-limit-tokens', b'200000'), (b'x-ratelimit-remaining-input-images', b'49999'), (b'x-ratelimit-remaining-requests', b'499'), (b'x-ratelimit-remaining-tokens', b'195200'), (b'x-ratelimit-reset-input-images', b'1ms'), (b'x-ratelimit-reset-requests', b'120ms'), (b'x-ratelimit-reset-tokens', b'1.44s'), (b'x-request-id', b'req_3a0ef508efce13303422d28d1152c7a6'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=RuZyY.30CKvegiI94iyhHAHiXLhiP1AHRy37nhEVbU4-1751986390-1.0.1.1-pfpFnKezB9FGRfS3b.01JgeqlcDY59FGdoybzSaOmh010fSWz_SLgs25auZtetLXW1YYPMOmOEpN1fTlg.U8arQ2S8B08zDRDw5cX3iSf6M; path=/; expires=Tue, 08-Jul-25 15:23:10 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=w6KJvXPz9MtoZkrU_bZxfCH4XkRjG4ZYEJqjVlUxvOs-1751986390901-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95c068c8ddfc4a1f-DXB'), (b'Content-Encoding', b'br'), (b'alt-svc', b'h3=":443"; ma=86400')])
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:tools.vision_discovery_engine:🎯 AI response received: {
  "email_selector": "input#email",
  "password_selector": "input#pass",
  "submit_selector": "butt...
INFO:tools.vision_discovery_engine:✅ Login selectors extracted: {'email_selector': 'input#email', 'password_selector': 'input#pass', 'submit_selector': 'button#send2'}
INFO:tools.vision_discovery_engine:✅ Login elements discovered successfully via multimodal analysis
INFO:tools.vision_discovery_engine:🔍 Validating discovered selectors...
INFO:tools.vision_discovery_engine:🔍 Validating login selectors...
WARNING:tools.vision_discovery_engine:⚠️ Discovered selectors failed validation
INFO:tools.vision_discovery_engine:🔄 Falling back to heuristic discovery...
INFO:tools.vision_discovery_engine:🔄 Running heuristic login discovery...
INFO:tools.supplier_script_generator:🛍️ Discovering product and pagination selectors...
INFO:tools.vision_discovery_engine:🕷️ Starting vision-based product and pagination selector discovery...
INFO:tools.vision_discovery_engine:📄 Extracting page HTML content...
DEBUG:tools.vision_discovery_engine:🧹 Aggressively pruning HTML content for AI analysis...
WARNING:tools.vision_discovery_engine:HTML content for AI analysis was truncated to 15000 characters. The original size was 151081. AI context may be incomplete.
DEBUG:tools.vision_discovery_engine:✅ HTML aggressively pruned to 15000 characters
INFO:tools.vision_discovery_engine:📊 HTML content processed: 15000 characters after pruning
INFO:tools.vision_discovery_engine:📸 Capturing page screenshot...
INFO:tools.vision_discovery_engine:🧠 Performing multimodal AI analysis for product and pagination elements...
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 08 Jul 2025 14:53:22 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-eywvpvgw4dvq99ktk9fwsqol'), (b'openai-processing-ms', b'5080'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'4842'), (b'x-ratelimit-limit-input-images', b'50000'), (b'x-ratelimit-limit-requests', b'500'), (b'x-ratelimit-limit-tokens', b'200000'), (b'x-ratelimit-remaining-input-images', b'49999'), (b'x-ratelimit-remaining-requests', b'499'), (b'x-ratelimit-remaining-tokens', b'194887'), (b'x-ratelimit-reset-input-images', b'1ms'), (b'x-ratelimit-reset-requests', b'120ms'), (b'x-ratelimit-reset-tokens', b'1.533s'), (b'x-request-id', b'req_26b514a155affa059db4d7f7ddfb65d9'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95c068f4788a4a1f-DXB'), (b'Content-Encoding', b'br'), (b'alt-svc', b'h3=":443"; ma=86400')])
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:tools.vision_discovery_engine:🎯 AI response received: {
  "product_container_selector": "li.product-item",
  "title_selector_relative": "a.product-item-li...
INFO:tools.vision_discovery_engine:✅ Product and pagination selectors extracted: {'product_container_selector': 'li.product-item', 'title_selector_relative': 'a.product-item-link', 'price_selector_relative': 'span.price', 'url_selector_relative': 'a.product-item-link', 'ean_selector_relative': '', 'next_page_selector': 'a.action.next', 'category_links_selector': 'ul.categories-list > li > a', 'breadcrumbs_selector': 'nav.breadcrumbs ol.items li.item a', 'image_selector_relative': 'img.product-image-photo', 'description_selector_relative': 'div.product-item-details div.product-item-description', 'out_of_stock_selector_relative': 'div.stock.unavailable, span.stock.unavailable', 'previous_page_selector': 'a.action.previous', 'page_numbers_selector': 'ol.items > li > a', 'price_filter_selector': "div.filter-options-item.price, div.filter-options-item[data-filter='price']", 'category_filter_selector': "div.filter-options-item.category, div.filter-options-item[data-filter='category']", 'search_box_selector': 'input#search', 'products_per_page_selector': 'select.products-per-page', 'product limiter_selector': 'select.product-limiter'}
INFO:tools.vision_discovery_engine:✅ Product and pagination elements discovered successfully via multimodal analysis
INFO:tools.vision_discovery_engine:🔍 Validating discovered selectors...
INFO:tools.vision_discovery_engine:🔍 Validating product and pagination selectors...
WARNING:tools.vision_discovery_engine:⚠️ Discovered selectors failed validation
INFO:tools.vision_discovery_engine:🔄 Falling back to heuristic discovery...
INFO:tools.vision_discovery_engine:🔄 Running heuristic product discovery...
INFO:tools.vision_discovery_engine:✅ Product selector validated: .product-item (5 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: .product (5 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: .item (4 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: .title (3 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: h2 a (3 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: h3 a (2 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: .product-name (5 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: .product-item a (3 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: h2 a (3 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: a[href*='product'] (2 elements)
INFO:tools.vision_discovery_engine:✅ Product selector validated: .product-item img (3 elements)
INFO:tools.vision_discovery_engine:✅ Heuristic product discovery successful
WARNING:tools.supplier_script_generator:⚠️ Login discovery failed, creating empty config
INFO:tools.supplier_script_generator:💾 Saved product selectors: suppliers/poundwholesale-co-uk/config/product_selectors.json
INFO:tools.supplier_script_generator:📝 Generating scripts from templates...
INFO:tools.supplier_script_generator:📝 Generated login script: suppliers/poundwholesale-co-uk/scripts/poundwholesale-co-uk_login.py
INFO:tools.supplier_script_generator:📝 Generated product extractor script: suppliers/poundwholesale-co-uk/scripts/poundwholesale-co-uk_product_extractor.py
INFO:tools.supplier_script_generator:🧪 Starting test-after-generate validation...
INFO:tools.supplier_script_generator:🔐 Testing login script...
INFO:login_module:🔐 Starting login to https://www.poundwholesale.co.uk/
INFO:login_module:❌ Not logged in
INFO:login_module:🔗 Clicking login trigger: header a:has-text('Sign in')
INFO:login_module:✅ Email filled
INFO:login_module:✅ Password filled
INFO:login_module:🚫 Dismissing modal overlay: .modals-overlay
INFO:login_module:🚫 Forcibly hid modal overlays with JavaScript
INFO:login_module:🎯 Enhanced submit button visibility
INFO:login_module:✅ Submit button clicked
INFO:login_module:❌ Not logged in
WARNING:login_module:❌ Login verification failed - analyzing current page state...
INFO:login_module:📸 Screenshot saved: logs/debug/login_failure_screenshot_20250708_185413.png
INFO:login_module:📄 Current page HTML length: 506718 characters
WARNING:login_module:🚨 Detected potential error indicators: ['code']
ERROR:login_module:Failed to analyze login failure: object str can't be used in 'await' expression
INFO:tools.supplier_script_generator:🤖 Performing AI failure analysis for login...
DEBUG:httpcore.connection:connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f5729ebd0a0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x7f572a532b50> server_hostname='api.openai.com' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f5729ebd5b0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 08 Jul 2025 14:54:22 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-eywvpvgw4dvq99ktk9fwsqol'), (b'openai-processing-ms', b'2475'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'2065'), (b'x-ratelimit-limit-input-images', b'50000'), (b'x-ratelimit-limit-requests', b'500'), (b'x-ratelimit-limit-tokens', b'200000'), (b'x-ratelimit-remaining-input-images', b'49999'), (b'x-ratelimit-remaining-requests', b'499'), (b'x-ratelimit-remaining-tokens', b'199013'), (b'x-ratelimit-reset-input-images', b'1ms'), (b'x-ratelimit-reset-requests', b'120ms'), (b'x-ratelimit-reset-tokens', b'295ms'), (b'x-request-id', b'req_9b7f5ee4bc87b942db8d75267a4eb1c6'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=hjgWaJSlym0AN_bUTsx8GHvvJDRH5CyiF8OU_gEN6Uc-1751986462-1.0.1.1-y3X.vIq6VUcDJ9o_oKAlRj34a_Bj0ORanW8Ryz5CIZliEFX5yudhv5j7LGz.QBWC5pV4RKdVZGH_CScUIZJeVVuoWwVS1JMJpJmnb4r4x20; path=/; expires=Tue, 08-Jul-25 15:24:22 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=HmAHOofDQz_3HgHrgw2Pz0aByV6LTcaGLe2qVhkMEMM-1751986462508-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95c06a7b6f08dddb-DXB'), (b'Content-Encoding', b'br'), (b'alt-svc', b'h3=":443"; ma=86400')])
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
INFO:tools.supplier_script_generator:🤖 AI Diagnosis for login:
INFO:tools.supplier_script_generator:   Likely Cause: The login page or login form is not currently visible or loaded; the homepage is displayed instead.
INFO:tools.supplier_script_generator:   Suggested Fix: Update the script to first navigate to or click the 'Register or Sign In' link at the top right corner to load the login form before attempting to interact with login selectors.
INFO:tools.supplier_script_generator:🛍️ Testing product extraction script...
INFO:product_module:🛍️ Starting product extraction for 2 pages
INFO:product_module:📄 Processing page 1
INFO:product_module:🔍 Found 20 product containers
INFO:product_module:✅ Extracted 20 products from page 1
INFO:product_module:🧪 Test mode: stopping after 5 products
INFO:product_module:✅ Product extraction completed: 20 total products
INFO:tools.supplier_script_generator:✅ Validation completed - Login: False, Products: True
INFO:tools.supplier_script_generator:📋 Generating intelligent .supplier_ready file...
INFO:tools.supplier_guard:✅ Created intelligent .supplier_ready file for poundwholesale-co-uk: suppliers/poundwholesale-co-uk/.supplier_ready
INFO:tools.supplier_script_generator:✅ Created intelligent .supplier_ready file: suppliers/poundwholesale-co-uk/.supplier_ready
INFO:tools.supplier_script_generator:✅ Intelligent supplier script generation completed successfully
INFO:__main__:✅ Intelligent supplier automation package generated successfully for poundwholesale-co-uk
INFO:__main__:🚀 Initializing centralized browser session...
INFO:utils.browser_manager:🔧 BrowserManager singleton initialized
INFO:utils.browser_manager:🔌 Connecting to Chrome on debug port 9222
