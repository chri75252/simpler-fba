# Amazon FBA Agent System v3.5 - Developer Guide

## Project Purpose
Enterprise-grade Amazon FBA product research and profitability analysis tool that scrapes supplier websites, matches products with Amazon listings, and calculates profit potential with AI-driven category discovery.

## Key Components
- `tools/passive_extraction_workflow_latest.py`: Main workflow engine
- `tools/configurable_supplier_scraper.py`: Supplier website scraping
- `tools/amazon_playwright_extractor.py`: Amazon data extraction
- `tools/FBA_Financial_calculator.py`: Profit calculations
- `utils/path_manager.py`: Centralized path management
- `monitoring/comprehensive_system_monitor.py`: Real-time monitoring

## Path Management Standards (CRITICAL)
**ALWAYS use path_manager.py instead of hardcoded paths:**

```python
# ✅ CORRECT - Use path_manager
from utils.path_manager import get_log_path, get_output_path, get_api_log_path

# Log files
log_file = get_log_path("application", component_name="passive_extraction")
api_log = get_api_log_path("openai") 

# Output files
output_file = get_output_path("FBA_ANALYSIS", "financial_reports", "report.csv")

# ❌ INCORRECT - Hardcoded paths
log_file = "logs/script.log"  # Don't do this!
output_file = "tools/OUTPUTS/report.csv"  # Don't do this!
```

## Directory Organization (claude.md Standards)
```
/Amazon-FBA-Agent-System-v3/
├── claude.md                   # File organization standards
├── docs/                       # ALL documentation (including this file)
├── logs/                       # ALL log files (by category)
│   ├── application/           # Main script execution logs
│   ├── api_calls/            # External API interaction logs
│   ├── tests/                # Test execution logs
│   ├── monitoring/           # System monitoring logs
│   ├── security/             # Security and audit logs
│   └── debug/                # Debug and troubleshooting logs
├── tools/                      # Core application scripts
├── config/                     # Configuration files
├── tests/                      # Test files
├── OUTPUTS/                    # Application data outputs
│   ├── FBA_ANALYSIS/          # Core FBA analysis results
│   ├── CACHE/                 # Application cache files
│   │   └── processing_states/ # Processing state files
│   ├── REPORTS/               # Generated reports
│   └── BACKUPS/               # Data backups
├── archive/                    # Deprecated/legacy files
└── utils/                      # Utility functions
```

## Coding Patterns
- Use async/await for all web scraping operations
- Implement proper rate limiting (2-3 second delays)
- Use path_manager for ALL file operations
- Always validate EAN/UPC codes before Amazon matching
- Generate CSV reports using standardized output paths
- Follow UTF-8 encoding for all file operations

## Configuration
- Main config: `config/system_config.json`
- Supplier configs: `config/supplier_configs/`
- Environment variables: `.env` file
- Path standards: Follow `claude.md` requirements

## Logging Standards
- Application logs: `logs/application/`
- API call logs: `logs/api_calls/` (auto-generated by path_manager)
- Test logs: `logs/tests/`
- Debug logs: `logs/debug/`

## Testing Commands
```bash
# Run all tests
pytest

# Run specific test categories
pytest -m unit
pytest -m integration

# Run with coverage
pytest --cov=tools --cov=utils

# Performance testing
pytest -m "not slow"
```

## Development Workflow
1. Read `claude.md` for file organization standards
2. Use path_manager for ALL file operations
3. Follow the established directory structure
4. Test changes with pytest
5. Check logs in the appropriate `logs/` subdirectory
6. Update documentation when making changes

## Important Files Locations
- Processing states: `OUTPUTS/CACHE/processing_states/`
- Phase continuation: `OUTPUTS/CACHE/processing_states/phase_2_continuation_points.json`
- Linking maps: `OUTPUTS/FBA_ANALYSIS/linking_maps/`
- Product cache: `OUTPUTS/cached_products/`
- System configuration: `config/system_config.json`

## API Integration
- OpenAI logs: `logs/api_calls/openai_api_calls_YYYYMMDD.jsonl`
- Keepa logs: `logs/api_calls/keepa_api_calls_YYYYMMDD.jsonl`
- Amazon logs: `logs/api_calls/amazon_api_calls_YYYYMMDD.jsonl`

Use `get_api_log_path(api_name)` to generate these paths automatically.